name: plan
scope: local
about: "Manage project tasks and steps with persistent state. Use to track work across sessions."

tools:
  # ── Task tools (top-level grouping) ──
  - name: plan_task_new
    description: "Create a new task with initial steps"
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name (e.g. 'implement-auth')"
        title:
          type: string
          description: "Human-readable task title"
        steps:
          type: array
          items:
            type: string
          description: "List of step titles to create"
      required:
        - name

  - name: plan_task_list
    description: "List all tasks in the workspace database"
    inputSchema:
      type: object
      properties:
        show_completed:
          type: boolean
          description: "Include completed tasks (default: false, only active shown)"
        show_all:
          type: boolean
          description: "Show tasks from all users (default: false, only current user's tasks)"

  - name: plan_task_complete
    description: "Mark a task as completed (must not be the active task)"
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name to complete"
      required:
        - name

  - name: plan_task_switch
    description: "Switch to a different task"
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name to switch to"
      required:
        - name

  - name: plan_task_show
    description: "Show detailed information about a task"
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name (omit for active task)"

  - name: plan_task_status
    description: "Show the active task and current step"
    inputSchema:
      type: object
      properties: {}

  - name: plan_task_notes_set
    description: "Set a note on a task. For goal/plan kinds, replaces the existing note (upsert by kind). For 'note' kind, pass id to update an existing note or omit to create new."
    inputSchema:
      type: object
      properties:
        text:
          type: string
          description: "Note text to set"
        name:
          type: string
          description: "Task name (omit for active task)"
        kind:
          type: string
          enum: ["goal", "plan", "note"]
          description: "Note kind: 'goal' (what), 'plan' (how), or 'note' (default)"
        id:
          type: integer
          description: "Note ID to update (omit to create new). Only used for 'note' kind."
      required:
        - text

  - name: plan_task_notes_get
    description: "View notes on a task. Returns notes with IDs for use with set/delete."
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name (omit for active task)"
        kind:
          type: string
          enum: ["goal", "plan", "note"]
          description: "Filter by note kind (omit for all)"

  - name: plan_task_notes_delete
    description: "Delete a note from a task by ID"
    inputSchema:
      type: object
      properties:
        id:
          type: integer
          description: "Note ID to delete"
        name:
          type: string
          description: "Task name (omit for active task)"
      required:
        - id

  # ── Step tools (individual items) ──
  - name: plan_step_switch
    description: "Switch to a specific step within active task"
    inputSchema:
      type: object
      properties:
        number:
          type: integer
          description: "Step number (1-indexed within task)"
      required:
        - number

  - name: plan_step_show
    description: "Show detailed information about a step"
    inputSchema:
      type: object
      properties:
        number:
          type: integer
          description: "Step number (omit for active step)"

  - name: plan_step_list
    description: "List all steps in the active task"
    inputSchema:
      type: object
      properties:
        task:
          type: string
          description: "Task name (omit for active)"

  - name: plan_step_done
    description: "Mark a step as complete"
    inputSchema:
      type: object
      properties:
        number:
          type: integer
          description: "Step number to complete"
      required:
        - number

  - name: plan_step_notes_set
    description: "Set a note on a step. Pass id to update an existing note or omit to create new."
    inputSchema:
      type: object
      properties:
        text:
          type: string
          description: "Note text to set"
        number:
          type: integer
          description: "Step number (omit for active step)"
        id:
          type: integer
          description: "Note ID to update (omit to create new)"
      required:
        - text

  - name: plan_step_notes_get
    description: "View notes on a step. Returns notes with IDs for use with set/delete."
    inputSchema:
      type: object
      properties:
        number:
          type: integer
          description: "Step number (omit for active step)"

  - name: plan_step_notes_delete
    description: "Delete a note from a step by ID"
    inputSchema:
      type: object
      properties:
        id:
          type: integer
          description: "Note ID to delete"
        number:
          type: integer
          description: "Step number (omit for active step)"
      required:
        - id

  - name: plan_step_new
    description: "Create a new step in a task"
    inputSchema:
      type: object
      properties:
        title:
          type: string
          description: "Step title"
        task:
          type: string
          description: "Task name (omit for active task)"
        description:
          type: string
          description: "Step description (markdown)"
      required:
        - title

  - name: plan_step_delete
    description: "Soft-delete a step"
    inputSchema:
      type: object
      properties:
        number:
          type: integer
          description: "Step number to delete"
        task:
          type: string
          description: "Task name (omit for active task)"
      required:
        - number

  # ── User tools ──
  - name: plan_user_show
    description: "Show the current user (OS login and display name/alias)"
    inputSchema:
      type: object
      properties: {}

  - name: plan_user_set
    description: "Set your display name (alias). This is how you appear in task lists."
    inputSchema:
      type: object
      properties:
        alias:
          type: string
          description: "Display name / alias (e.g. 'PAC')"
      required:
        - alias

  # ── Project tools (workspace metadata) ──
  - name: plan_project_show
    description: "Show project metadata (name, path, description)"
    inputSchema:
      type: object
      properties: {}

  - name: plan_project_set
    description: "Set project metadata (name and/or description). Call this when prompted to identify the project."
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Project name"
        description:
          type: string
          description: "Project description (markdown)"

  # ── Config tools ──
  - name: plan_config_show
    description: "Show current configuration (merged defaults + config.yaml overrides)"
    inputSchema:
      type: object
      properties: {}

  - name: plan_config_set
    description: "Set a configuration value in config.yaml"
    inputSchema:
      type: object
      properties:
        section:
          type: string
          description: "Configuration section (e.g. 'workflow')"
        key:
          type: string
          description: "Configuration key within the section"
        value:
          description: "Value to set (string, number, or boolean)"
      required:
        - section
        - key
        - value

  # ── Report tools ──
  - name: plan_project_report
    description: "Generate a project report (.md) with all tasks, goals, plans, and steps. Written to workspace directory."
    inputSchema:
      type: object
      properties: {}

  - name: plan_task_report
    description: "Generate a task report (.md) with goal, plan, steps, and notes. Written to workspace directory."
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Task name (omit for active task)"

  # ── Utility ──
  - name: plan_readme
    description: "Fetch the plan README and display it IN FULL to the user. The result text must be printed completely in your response -- do not summarize, truncate, or paraphrase. The user is reading it to learn how the system works."
    inputSchema:
      type: object
      properties: {}
